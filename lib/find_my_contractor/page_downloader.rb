# frozen_string_literal: true

class PageDownloader

  URL = 'https://cslb.ca.gov/findmylicensedcontractor'
  HEADERS = {
    "accept" => "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9",
    "accept-language" => "en-GB,en-US;q=0.9,en;q=0.8",
    "cache-control" => "max-age=0",
    "content-type" => "application/x-www-form-urlencoded",
    "sec-ch-ua" => "\"Not_A Brand\";v=\"99\", \"Google Chrome\";v=\"109\", \"Chromium\";v=\"109\"",
    "sec-ch-ua-mobile" => "?0",
    "sec-ch-ua-platform" => "\"macOS\"",
    "sec-fetch-dest" => "document",
    "sec-fetch-mode" => "navigate",
    "sec-fetch-site" => "same-origin",
    "sec-fetch-user" => "?1",
    "upgrade-insecure-requests" => "1",
    "cookie" => "ai_user=WzGeu5mGJDtMkaREPLLBNL|2023-02-12T19:43:13.398Z; __utmc=158387685; ASP.NET_SessionId=qquwdls4abbwnk4m5axokbxv; __utma=158387685.1979844702.1676230994.1676275707.1676278474.3; __utmz=158387685.1676278474.3.3.utmcsr=upwork.com|utmccn=(referral)|utmcmd=referral|utmcct=/; TS01ace835=01ed741c22e4e1d668ff186a5d7607cbe16a175e66bdb99551e3287cac11bf8dbf0ad2564813bf301564125153733bbe8cd21bc9ab; __utmt=1; __utmt_b=1; __utmb=158387685.30.10.1676278474; TS8d13ad08027=08127bdcf5ab20009992b511511297020c096e41b1d3c6d3201b353c5d261eb27579544da3d487e608d45bcd69113000c05edffb8147bdee600f0920e1b0204b44af83d7080d21ad5a2a681f5b66bdb07c9cbcad1857f2e13e34bb69b97bc04b",
    "Referer" => "https://cslb.ca.gov/findmylicensedcontractor",
    "Referrer-Policy" => "strict-origin-when-cross-origin"
  }.freeze
  MAIN_BODY = "__LASTFOCUS=&__EVENTTARGET=ctl00%24MainContent%24btnZipCodeSearch&__EVENTARGUMENT=&__VIEWSTATE=FuaJ5CeiezZPTCVtVsPqKW08xJDKq%2FDZI2LXsUWvirSOGxWVN%2FBhYzEQLGfnrOwjLMmBBcHj5ofjBiJ21zCeJ5jItu9vWEZN0ZcqALX8lOuzx5To9uTSb%2F6g%2ByUTNPV21%2Bu8Otch9AEN0iUFpLL2n3OR7Smusx3kvW2wESyAYrYfFytH91AynCzUQ3IQU0yoquD%2Fe7waLLbmYMQtL9GIeUwuUIbZNb%2FImd7JMh4zo2460fkk8uKQyUJPL8yL4eFl32f5ugq%2F5UhlnUhSkP14SMZtIq4XsS5m%2Bz%2FjzuPTydm5orOmDAImCZI9ZbE0kXIFGBynG74yZsykUfSXPwMtLxcTFM3Mb%2Bsf3aNIeFDJIIMbusawBb3%2F4gNynJVzkGtklOzJgyp8EaWwwnrPIG1sLJAx8JMyPLHQgFIHs7CfeOFei2Y0rhO7R1YicGaPdSqRwYYTDR6oqCz6zOgu%2BLFeGIzVf%2BghkPdW7XXliIGQMuI5GtVyGIiDDUsCV5hAEJpgvsDZWns7ngrDqJ40X6Xlb94g7DIgde9shw8S6txc6e1j10fBxJ7zVsrmeCGGhiPXrtjVprgza4%2BK483ObZhC3w%2B9pCzcCHtqcALh69RNIqfUcuK9EumxByUsB%2FYWRRZnx1s1xrq4r%2BERY8F0jR24R%2BtpPUNkqZZRvaDmFzspjnWKccPYQzvTVrMGFuWPmqE3EiZqdmAuKwZ6zdng1aPewO4ZE04BMjnzUXxDTdOIVKxEPXtDyP080Imc6F9NUloSxLvskkMDCuuKUvDpBApzI6HbidrWuOtASBTbUB8lJ0KdDTaNWWMRPab0RLe9WhkTrpcKupzFdIt1jcE09h6tW%2FejoIetjiMEVBGujjVbg%2FTSQLvRrHvjILy%2FXT120dviLwCPKn0IKPQrcjdrzNtbkh3TBH0xRMLUdseI6%2BJrl0K8CHl5sRCrvE4eL2WHoUP70%2Fm9FsFfwzgm0ZasKhfVtgqTK2VbzGAMMsGmM0Ie61UWvz5ZRJlnKmJNoMVXp9R9n5wXE2A8knDbkjjvlMeKDEj2I6fJNGrERMTc54U7DpBfOr05qREZR8HDDYslSF9GfirRD1TFRgR537i%2BYAHZ5PofTQh6AL3KqCwZd%2FwnruysJtySvx11jgCRN8EG97nCLq6c9Nhb5ujRYODTn1TKd3bSa62hTtNNieDyW3DFLK0BK6v5vcGgNApP058YGmr0a9wywFbCaqyqhADpIEDmxU6LFwRy9rHT2ysLdtYQuRL0Fj7yZasTsDSZEd%2Fy5OZm10%2F9xoXsgbivnveQDvXPOrV7fdZL9S3c3pbJbsTzIIieqzFGFQlpX01UD0VUbUEadb%2B4RTu%2Bf7JjHJjbtouy1mqohHzals5OjXhgwWlWDPfBIKamQ%2FXGpJq1UlaLxPMYgousDS1OpMNQ2oPRo%2F00%2FnKgn12k64%2FJioZrLMUtu%2FYOnb0MqWSM6vSw5whIsYKlPJJo1SJx3ZJBfXrVqYPRVx2%2BgSzLbpGJvIEytG4CCMfZ385cPxcKP1OC0naAN%2BW2aNKkHbbSBZXfjLiyNW5IHoKhq%2BxHCPsxqNOffrwT%2BQwVbg6mE2gh%2FKKOOb4aZ%2FWsWjkF8gKQ6OQ6ZNcKhGtDzz779tEKh8KyWBinOZA8XytdkmTpQd3hNcX1smzw4V2C23fmioxSwe03BW8vEyfjhNdQy5jk57NGkPj76B0TjRyL8AO5ckyA9l6oeypJMy8t1fSVPZveDV4V%2BYAjq25MDiX%2B%2BF5SCCxOAUzCvI41M0Udx2MYxU6dAAlMmE%2BTsY5Kn2W39Pz1j26oFWovBWlrbg0j%2Fa%2B5SAQEpb2cSiTeecsezZi1fYcpN0x2zfjXGacWj1iiey%2FuPP93h2985S7wr4E0UIqJ5HqrxL2OQOxF%2BYnGxHwSdfKAxzFBzEV3jSDF2OjVZA43e37CaMtj8cfjdM%2BOtJC8vb1om2VaCU0O%2BpMeJHzTiJtqUXnRnD0Vgwbxe45EPxRH5tJqpJzQi7flrYALMwfZ72jNnw7vdQ9jfPYfd286mkuZbUvZXP%2BwRyERYJhjbXTzCZCtR3487fQYUwx0nUyTRhcjkQI1SRtVSlCPazc1nbEcYkXHF2qlBlBskfJRxV77EYaFUKcayEDTUy%2B%2BGGwf5%2F2yvVKQ769oZttOTC6sD1xqHOWY1PegRBE5gjzzwWj%2FXqzspqV7v38E1vbZtqWJ2zAytTNAYisUmEKXMJWl0PIrYog7%2B8q6l7SGn85KIVP5U5l7%2BQQCNKEDXoWe19VJD7Oy4tamEdFNPfPBlkqeue9DR92BKO0Jb%2BM4O87U1nb%2Bklsz%2FA8flE5B1tuANTCW99%2BSda%2B9aIt2xP%2FdfJ6z5dS%2B94CHDIjNApb5IZVjxlHUnerqVyziqfYJ2dJFtoHdPfX%2B1hUaZwLANCFlFTkYtqT%2F2p0zYPhU2Q9BvPdy86wmLe99aSffR5fUsXcToRXyS0q7vjVsA%2FAkDGQ1SsSTHIbRWuX%2FX6c15OFgctbf7rooPY09%2B850L%2BuOeKfKHSLTnCINVNPnuEwd6HQshIlROjHWUVesZdN%2BOXPgxJBOKoR5q1IglMOapyB0nH%2BMnCR06IdfpsWb78TlhqC6ZcKL8YnB7D%2Bv7zeQezx3C40i%2BPzN1P5Lsrw6rfxWuTal7bQIEVHyrZpAAJDOVfm0L6Zflqjo9tdKElG8ACPEoA1%2BcBc4QvEfOFwolrJYnxfVPLsHqDBvhAhrnwbNGMUjuM4zVuVh3bGFHJuTqy2Fm1spsIdMC1ZnOspdGei4h4xWEzk53M7IdpaP%2FpuWJXNdG%2Bf%2FmR9MEbRna4ta6fZU5kkSF6GCAwM87yzbkimRfbhU9ZrnQrPUDZ9Ne70TayIPgQ4YCFdO1bWJOINUJ9qx37ioVJAvIym9t2n5qKtd%2F%2BW0JUI3gOGlv%2FRgUpImI3a6doDIfVrGAwKaalfhM53EQXDoJcNMYcOmkGeda4WLwTbjt4rd66g9mygXcCzsaC2cLpjjVuxrSoquCbVieJHPEu5YOn1ryxA55aTcl3H8f77vddCu6jZ1EYo8VQ6%2B6WVg5B2A6wnoo2sEb1hMUFba7fsFA%2F4%2FHMeemXaF%2FfzQspqWuFFsGJQS2cHqKbgzRVrI95eDeyKBtKRNbxnjK0ZNSkfhahaD8Gm5OYHlyr6ssNeiStYD5tSk2%2BZCJ21BwEyqAI8GO1ii3vjpdEZ%2BpAlts6VLuEZSWSPv%2Bvj1cfpP27MppZM6bPnvzZwubplwGOcpWEXrNjU6cUyg6KG5w5tXu1uw8DWiGRcn1GvJtXEPPekf0GAAZGY62tsuferoxDZ%2BvlyJto%2F9ZGet%2BLWup9nw%2BEePwzbnp89y0EVDEYk4QlrAeo5Dp8qQOusBDGycMqqkCF61xEf6%2FsILQVf5MW7y%2FIjVv%2BmcNpofHbCpBJ0cBI8NW6gBucCV6MoOAA%2Buel3088ntZ2OklwipY0oEyAR6mNtWevkJBt7gDcfrUXKbHmT6I51i5raDCoirZGj9I5uBpc28i5Cv7n7UK%2FaFOICiX17EkCmIgafSX0gZy%2BIDwXYpKieEXi5%2B8MiJbQTCumH8eT79bDPTCaCelZaaGnogTkXBG4zDSR%2BNzhntC9EHZsDPTHw5BRvTf09px3latuDSsymhnTjCWUdiTXZeh%2Bu1GUYHtrWlMC8%2FSbBER9daAAu%2Fd0bpjelxbIYRWqWkoBe%2FzoTZABnyfNFQCeLXpF0eYZ82o0BxxrvWJc0lUUjRw6tANp5VtX%2B3%2BOMnYfVvACQJZGsHq3oJZgiJ%2FY99ThTJeRfNLpceI2d2%2FkoGgBKzYe8Zm55%2BXNydc%2BAV3j8HrXalE2Vm2t55K8ilnUn%2BG0QesB%2BRDtO%2Ft1abknL0fdRE13j3sYAElfD26vqXSJorJNGPyif7r8QW%2B%2FfYBd6TrvVUdI5mtbmiPXeeN3u1s9FgBmM3VggsTazYDLJ%2BTvZ%2BUNpeR6l0JxjNgxMQzYSQGT2ouhAgbVHMTfn4oMKkce7iGWzg%2FZLxiR6m2ED3UnJiocuF2UxAg9m0fOY6EDoK8G%2F0OcLMyFZ5hQ4dzGwqyGxEnVlIeOfRz4bywFN4C1OgDQuBFyOX%2BuetPwMzY2TV5e83CssMTxqGcOhdiRPv%2Bh%2FMwqSh%2FU9oPdwvi7cDBzS4m6vCV8MAUYosQiELD7k1ZE2k5WHAmZAY0IVKA7nMCx5KsfZD%2FmEjy8aVLPztShVsIokEA9hXgTnhL2XTi%2BU0PKNxh9Yjd1vSfdPQ7GsS5HdIsEHL%2FGG1plCl5hU47QfbLJCQcAB0jHBsgfqpdGmZfAI6FM%2BvORFigUw2KNl6eESJHi28fgeBYdNOd5zVRexK7pra7ub%2FFPgALpUAI1gXqMFM6FhkHHRZ211m5wEeyvA1C3QWK5qO1KVZiq3tQljcmPugjA0y1EyiLM%2BO0%2FSGikBrVSJ9zaNPkqlzqSldCPe8v8uAU%2FfNXbyOJfyci8AxFKssODgRmiED3aqe%2FY5vo51EgGBvfznOytsOD58H81Mhmf4rdSBOf5jkOoaiBfdJiu1%2BDwvUtOwBlps1pAd4EZdNNoQtLUHLaE3PCvuAZPtxXeiN7lHfN2%2BgZ4mjtieIRMK%2FdtpSuBjx82gNaRhwkVkK%2BUlIi9cHUQG38kBWw4j6Wa5bB4jRFkNYuLyfJ%2FkbY3nDJsouXw1NS2J89fDTxc5uD4PZLXH8hjTdIfu3djTIItlzZ%2FhMmHG21m8cYN8SqQxqPzRP3OOaXg9pSXPy3m0qqailCzpM4qkSqt6X%2BLaZVCT6UPtPVq5cONEQLG5KT91t9UFexPPh4Yhxydihnm7xx2Xpd7fs8QSGhjVUhS0I5HSk4zgCqaKWAgh4isEBsOqdvVhIjE8BIXo4gAu0Z1DneEc2lHuHS3InIjKnfmdQOwBgRJzYhvB3COGSV004XNqhHC2OvOQKv%2FZj1U2lfk%2Fp7Rh3ZRTsn3t94EutoVbwLKRjwm510vMaX3Uc4WN6s2aFT4OkHFJu4gRNglytN6JNoz7fmyMkEjAtIZUHrQdTlHNvpbi8K5dfwVHV7v2xoW%2FoA70gzWPVMJjBVMW6fQ50nbJ5K6nMgoLOzcsWgfUc1BfuhOxmoaS525N8BrlDyelKcgASsvxlLWMIwmwwm0EKNTl6cM05MB%2BdSpy55a7XtfXK7vWTwo9Tvsd7JcUwiW2Ff9bc&__VIEWSTATEGENERATOR=AFD32C62&__EVENTVALIDATION=I2bIKt7femgaytqvMSVSuCJvEPYw9%2FkBkE0TXKlTPe9ZvZK2I8zzZ0hPEzMDQBV9tU%2BTZF9qStRM5ln7alQMBA%2Bw71Q3aDNL4XlNBNa0dwdE%2FX69SNGToANxDi%2BjC8jX5w9lzXwQxNNlARvhnFQu5t%2BiyvCB8TNDJherxWq2j9IpJPWloEEBTqovjic6VnVxpX0cNRgpZuqbOmxRvfkPTPYcmPueEbLvY951frCgQsSr1WWHROOTQACTNqCGOgUvwvzpG%2F92QeYu7TQiW2wohNTcTehT8tbjPVhBmRtlAkq6T93lk1zDSZUJ0mzkQAOsxT8vx4pvbCql2eekdTetC7psSWhpvSPLJJ%2FqGs1uJoL7xAA0brqnCrEwK2UiQfk2Kgf2di9GA6ITvGirtg23MEwCzQDMp%2BrEMc7%2FOWlKy%2FDvh0zMAG1i8offhPHbG8XF6t8GiyLlxM%2BhgHqAUs%2Fdr0%2F2wlxxyOGh0575Gwxe8qmrYApAI4p5R8CrkxeRAd8kYokHlnAZDWMWqj%2ByHn%2F67%2BpyLW4yXiuJmXr9FuXtujeUlDK6p8driSG%2FxchJse6aXVsAUpOuwxV2CKXtK2ZUCHlBanI9rWyK7VsDtFFvHJ%2F4TVAMRVc9O2dYrV45nKcQonlXrdm5li22Obn6ujA%2BbDhOauFoE2QWjWxnOtRj3k8XTACsvIOOSfcPVML1oSFQxq3of6mf71hheYTmKlMnVBhnrC91d%2FGZlqEfQK3sKUIC2ub9%2BtOhZVRxZ9TtEYvIuyx1RlCHCgAY2F7TpbyaaTUUXbKN5u4xll7m4W8LYKYNK4rBSPOY1oib6bnT771l0j%2BOrrgwSKii3STF%2FpubOqrFEDLbGGYV%2F6WmpBPnP%2FcASpAJTef9wrexvlKfDvplYr3JGI7kXF4psSXV8Q9xNBrV0oC1DXxnccmAAwSIj89e2yGImgGAsxOPXAcL3Y5gVRPn1XLIDFhs9GiNB4OtZU5H4OyoDNPGReRXjBD7kBaVKTscrMSzrkSFf%2Bob%2BwRBI7pvCA7cKFK0r4A7qEwah0vTvUM1il0M7Zz2LQKpwZLi%2F6W1RivnF%2F6aVNebkqS%2B7s%2B%2F743dHgXuhCJ932jVN33z9QMWyJrrysnWr7q5c4PXRqO8fUoa0sEC7A2tRjVEOsRMtD6O6YzI2NjG8bchGLmEM3bAe4dhe3eK3mu70yt5EGwoVUxTzbdnPagB2QtDkkpckEeAPaiGhz9bi50Jgwb9lN4KSlhfV7x1F20EADtRiZdf9HggiDqLyrPjuRcyaXotAyP2SrGO0S5kUrVvvj3vXgB%2Bp4QQsR0atRdbS4aPyug0ttanR8FEeBFBYSWuFoINCwO60A3nXnnrHlLVZ93mROg0JVoTKg2O8oJ9ykSt24Ipi86sbFkIMqPYxT7YBx92QfFz2pGgkQxIjUlH%2B1nhWquo28z%2FSeKOMNqLMUS7AsQjonqY774LiKj6pj3ZJsOxWU%2BNt1%2F0T3oXo3%2BPfW5AXW%2BRFHdVL7G%2FtMwiocDFLYjcPxt8g4g0k6qamlY93VTIfTBqS85GDqDJvtJ3Bvrr81qf%2F78fy%2BTalJZ3Q5EGHttDAM9FnmZoYMbqjWUxB2ppGlXrRbkYaoyKfRjhhuu%2BXxmNOJj8wWKOuceV8zXs4cifW8lULJpkKA2XT%2BKOvHHIrOSL%2F88cfqwDyXZqtoWYvMeIaCd44JMovjOsoMHyRrUxYpctCCjgvM%2ByjUFEaeSWgzMXBNRsw8IjeiCK%2FfJuEixZshBmSJ%2BaeBqbavNqlWROysNDXKR3pWq83Wq49T3fsgo3Enj5aIBAL1laxzQzjE0%3D&ctl00%24MainContent%24txtCity=&ctl00%24MainContent%24"

  def download(zip_code)
    Nokogiri::HTML(
      HTTParty.post(URL, body: form_post_body(zip_code: zip_code), headers: HEADERS).body
    )
  end

  private

  def form_post_body(zip_code:, license_classification: 'C-60')
    "#{MAIN_BODY}txtZipCode=#{zip_code}&ctl00%24MainContent%24ddlLicenseType=#{license_classification}"
  end

end
